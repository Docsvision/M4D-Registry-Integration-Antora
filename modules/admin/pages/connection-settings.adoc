= Настройка подключения к централизованному реестру МЧД

Модуль отслеживает сообщение о необходимости регистрации МЧД в карточке сообщений. При получении запроса формирует обращение, содержащее запрос на регистрацию, в {kd}. Модуль получает подтверждение регистрации обращения и выполняет запросы с заданной периодичностью отправляет запросы в {kd} для проверки факта регистрации доверенности. После подтверждения факта регистрации доверенности в _{log}_ добавляется соответствующая запись, поля карточки СКД изменяются соответствующим образом.

Все действия с доверенностью отслеживаются и могут быть просмотрены через сообщения {of-mc}.

Администратор должен настроить расширение в модуле {mc}.

[#mancons]
== Настройки модуля в {of-mc}

. После установки модуля _{mir}_ в _{sett-serv}_ Консоли автоматически появляется процесс Службы {ws} со специальным типом конфигурации.
. В {of-mc} откройте вкладку "Служба {ws}" и подключите новый процесс. Подробнее см. "xref:5.5.1@mgmtconsole:user:worker-service.adoc[]".
+
// .Вкладка "Служба {ws}"
// image::worker-tab.png[Вкладка "Служба {ws}"]
+
. Нажмите на кнопку *Подключить процесс*
. В появившемся окне введите _Имя процесса_ и выберите _Тип конфигурации_ *_Коннектор к реестру МЧД_*.
. В настройках созданного процесса заполните обязательные поля:
+
* В выпадающем меню _Сервис по работе с МЧД_ выберите значение *_{kd}_*. +
Поле обязательно для заполнения.
* В поле _API-ключ_ укажите ключ API для аутентификации в сервисе {kd}. Введённый ключ будет сохранён в зашифрованном виде, после сохранения он не может быть прочитан. +
Поле обязательно для заполнения.
* _Интервал запросов_ -- значение в секундах, в соответствии с которым будут происходить обращения в сервис {kd}. По умолчанию интервал равен `0`. Рекомендуемый интервал `15` сек. +
Поле обязательно для заполнения.
+
* Соединение {dv} -- поле необязательно для заполнения, подробнее см. в разделе "xref:5.5.1@mgmtconsole:user:worker-service.adoc#add[Добавить процесс]" документации модуля {mc}.
* Таймаут -- поле необязательно для заполнения, подробнее см. в разделе "xref:5.5.1@mgmtconsole:user:worker-service.adoc#add[Добавить процесс]" документации модуля {mc}.
+
. Если в процессе выполнения запроса возникла ошибка, она будет отображена в {of-mc}, на странице "xref:5.5.1@mgmtconsole:user:msg-outgoing.adoc[Очередь исходящих сообщений]".

[#register]
== Регистрация МЧД

.Чтобы иметь возможность регистрировать МЧД в распределённом реестре, выполните следующие действия:
. Создайте вид карточки для работы с МЧД. Для {wc}а можно воспользоваться готовым примером. Для этого нужно импортировать вид карточки документа ПКД menu:PowersOfAttorney[Data > SolutionOfPOA.sol] из примера "xref:5.5.17@webclient:programmer:other/powers-of-attorney.adoc[]".
. В разметку просмотра МЧД (версия 002) добавьте ЭУ `_Кнопка_`, например, *Зарегистрировать МЧД*, и добавьте скрипт `sendForRegistrationToRegistry` для события `*При щелчке*`.

[#recall]
== Отзыв МЧД

.Чтобы иметь возможность отозвать МЧД, зарегистрированную в распределённом реестре, выполните следующие действия:
. Создайте вид карточки для работы с МЧД. Для {wc}а можно воспользоваться готовым примером. Для этого нужно импортировать вид карточки документа ПКД menu:PowersOfAttorney[Data > SolutionOfPOA.sol] из примера "xref:5.5.17@webclient:programmer:other/powers-of-attorney.adoc[]".
. В разметку просмотра МЧД (версия 002) добавьте ЭУ `_Кнопка_`, например, *Отозвать МЧД*, и добавьте скрипт `recallPowerOfAttorney` для события `*При щелчке*`.

[#check]
== Проверка МЧД

.Чтобы иметь возможность проверять в распределённом реестре статус МЧД, полученной от контрагента:
. Создайте вид карточки для работы с МЧД. Для {wc}а можно воспользоваться готовым примером. Для этого нужно импортировать вид карточки документа ПКД menu:PowersOfAttorney[Data > SolutionOfPOA.sol] из примера "xref:5.5.17@webclient:programmer:other/powers-of-attorney.adoc[]".
. В разметку просмотра МЧД (версия 002) добавьте ЭУ `_Кнопка_`, например, *Проверить МЧД*, и добавьте скрипт `checkPowerOfAttorney` для события `*При щелчке*`.
